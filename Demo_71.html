<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Bootstrap_files/CSS/bootstrap.css">
</head>
<body>
    <table class="table">
        <thead class="table-warning">
            <th>Sr.No.</th>
            <th><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'authors')"> <br> Authors Name</th>
            <th><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'title')"> <br> Title</th>
            <th><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'subject')"> <br> Subject/Topic</th>
            <th><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'first_publish_year')"> <br> Year Published</th>
        </thead>
        <tbody class="table-secondary">

        </tbody>
    </table>
    <script>
        let booksDataArr = []
        const getBooksProducts = async () => {
            const url1 = "https://openlibrary.org/subjects/history.json"
            const responseVariable1 = await fetch(url1)
            let data1 = await responseVariable1.json()
            booksDataArr = data1.works
            const url2 = "https://openlibrary.org/subjects/science.json"
            const responseVariable2 = await fetch(url2)
            let data2 = await responseVariable2.json()
            data2.works.forEach((element)=>{
                booksDataArr.push(element)
            })
            const url3 = "https://openlibrary.org/subjects/science_fiction.json"
            const responseVariable3 = await fetch(url3)
            let data3 = await responseVariable3.json()
            data3.works.forEach((element)=>{
                booksDataArr.push(element)
            })
            const url4 = "https://openlibrary.org/subjects/geography.json"
            const responseVariable4 = await fetch(url4)
            let data4 = await responseVariable4.json()
            data4.works.forEach((element)=>{
                booksDataArr.push(element)
            })

            /* const url = ["https://openlibrary.org/subjects/history.json", "https://openlibrary.org/subjects/science.json", "https://openlibrary.org/subjects/science_fiction.json", "https://openlibrary.org/subjects/geography.json"]
           
            url.forEach(async (linkItems)=>{
                const responseVariable = await fetch(linkItems)
                let data = await responseVariable.json()
                data.works.forEach((element)=>{
                    booksDataArr.push(element)
                })
            }) */

            console.log("old Array = ",booksDataArr);

            /* let authorsArr = []
            booksDataArr.forEach((authorsElement) =>{
                authorsArr.push(authorsElement.authors[0].name)
            })
            // console.log("Authors Name Array",authorsArr);
            let subjectArr = []
            booksDataArr.forEach((subjectElement) =>{
                subjectArr.push(subjectElement.subject[0])
            })
            console.log(subjectArr);
            
            booksDataArr.forEach((element,index)=> {
                element.authors = authorsArr[index]
                element.subject = subjectArr[index]
            }) */

            booksDataArr.forEach((element,index)=> {
                element.authors = element.authors[0].name
                element.subject = element.subject[0]
            })

            console.log("New Array = ",booksDataArr);
            
            let rows = ""
            booksDataArr.forEach((element, index, array) => {
                rows = rows + `<tr> <td>${index+1}</td> <td>${element.authors}</td> <td>${element.title} </td> <td>${element.subject}</td> <td> ${element.first_publish_year}</td></tr>`
            });
            document.querySelector("tbody").innerHTML = rows
            return booksDataArr
        }
        getBooksProducts()

        const filterColumns = async (argFromInput, columnName) => {
            var filterVal = argFromInput.value.toLowerCase()
            var filterOutput = booksDataArr.filter((element, index, array) => {
                if (element[columnName] != undefined) 
                    {
                        return element[columnName].toString().toLowerCase().includes(filterVal) // returns true or false
                    }
            })

            let res =""
            filterOutput.forEach((item, index, array) => {
                res = res + `<tr> <td>${index+1}</td> <td>${item.authors}</td> <td>${item.title} </td> <td>${item.subject}</td> <td> ${item.first_publish_year}</td></tr>`
            })
            document.querySelector("tbody").innerHTML = res
        }
    </script>
</body>
</html>