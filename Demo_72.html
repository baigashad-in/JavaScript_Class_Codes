<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Bootstrap_files/CSS/bootstrap.css">
</head>
<body>
    <table class="table table-striped table-hover">
        <thead class="bg-success">
            <th class="bg-dark text-white">Sr.No.</th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'Name')"> <br> Name of Stock</th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'Symbol')"> <br> Symbol</th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'MarketCap')"> <br> Market Cap</th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'CurrentPrice')"> <br> Current Price	</th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'HighLow')"> <br> High/Low</th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'StockPE')"> <br> Stock PE </th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'BookValue')"> <br> Book Value </th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'DividendYield	')"> <br> Dividend Yield </th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'ROCE')"> <br> ROCE </th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'ROE')"> <br> ROE </th>
            <th class="bg-dark text-white"><input type="text" placeholder="Search" onkeyup="filterColumns(this, 'FaceValue')"> <br> Face Value </th>
        </thead>
        <tbody class="table-secondary">

        </tbody>
    </table>
    <script>
        let stockDataArr = []
        const getStockListing = async () => {
            const url = 'https://api.freeapi.app/api/v1/public/stocks?page=1&limit=1000';
            const responseVariable = await fetch(url)
            let outputData = await responseVariable.json()
            stockDataArr = outputData.data.data
            console.log(stockDataArr);
            let rows = ""
            stockDataArr.forEach((element, index, array) => {
                rows = rows + `<tr> <td>${index+1}</td> <td>${element.Name}</td> <td>${element.Symbol} </td> <td>${element.MarketCap}</td> <td> ${element.CurrentPrice}</td> <td> ${element.HighLow	}</td> <td> ${element.StockPE}</td> <td> ${element.BookValue}</td> <td> ${element.DividendYield}</td> <td> ${element.ROCE}</td> <td> ${element.ROE}</td> <td> ${element.FaceValue}</td></tr>`
            });
            document.querySelector("tbody").innerHTML = rows
            return stockDataArr
        }
        getStockListing()

        const filterColumns = async (argFromInput, columnName) => {

            // var arrForFiltering = await getStockListing()

            var filterVal = argFromInput.value.toLowerCase()
            var filterOutput = stockDataArr.filter((element, index, array) => {
                if (element[columnName] != undefined) 
                    {
                        return element[columnName].split(",").join("").toString().toLowerCase().includes(filterVal) // returns true or false
                    }
            })

            let res =""
            filterOutput.forEach((item, index, array) => {
                res = res + `<tr> <td>${index+1}</td> <td>${item.Name}</td> <td>${item.Symbol} </td> <td>${item.MarketCap}</td> <td> ${item.CurrentPrice}</td> <td> ${item.HighLow	}</td> <td> ${item.StockPE}</td> <td> ${item.BookValue}</td> <td> ${item.DividendYield}</td> <td> ${item.ROCE}</td> <td> ${item.ROE}</td> <td> ${item.FaceValue}</td></tr>`
            })
            document.querySelector("tbody").innerHTML = res
        }
    </script>
</body>
</html>