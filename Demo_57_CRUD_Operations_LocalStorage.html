<!DOCTYPE html>
<html lang="en">

 <!-- task : do previous crud operation using local storage -->
<!-- task : add image  and show it in table in previous task-->

<!-- // Local storage can store upto 10MB data. Can be accessed in different tabs also.
    // session storage can be used on same tab only. -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Bootstrap_files/CSS/bootstrap.css">
    <link rel="stylesheet" href="Bootstrap_files/CSS/all.css">
</head>

<body onload="tableLoad()">

    <div class="mb-3" class="container">
        <div class="row">
            <div class="col-sm-4 shadow-lg mx-auto mt-3">
                <form action="">
                    <div>
                        <h4 class="text-danger text-center mt-2">Registration<span class="text-dark">Form</span></h4>
                    </div>
                    <label class="form-label">Name</label>
                    <input id="inputName" type="text" class="form-control">

                    <label class="form-label">Email address</label>
                    <input id="inputEmail" type="email" class="form-control">

                    <label class="form-label">Mobile Number</label>
                    <input id="inputPhone" type="number" class="form-control">

                    <label class="form-label">College</label>
                    <input id="inputCollege" type="text" class="form-control">

                    <label class="form-label">Image Source Path</label>
                    <input id="inputImage" type="text" class="form-control">
                    <br>
                    <div class="d-grid col-8 mx-auto">
                        <button id="btn1" onclick="addUser()" type="button" class="btn btn-primary mb-3" >Submit</button>
                        <button id="btn2" onclick="updateData()" type="button" class="btn btn-success mb-3" >Update</button>
                    </div>
                    
                </form>
            </div>
            <div class="col-sm-2 mx-auto mt-5 shadow-lg" style="height: 150px;">
                <label class="form-label"><h5>Filter</h5></label>
                <input id="inputFilter" type="text" class="form-control" placeholder="Enter Name...">
                <br>
                <div class="text-end">
                    <button id="btn3" onclick="filterData()" type="button" class="btn btn-warning text-white mb-3 ">Filter</button>
                </div>
                
            </div>
        </div>
        <div class="row">
            <div class="col-sm-9 mx-auto shadow-lg mt-2">
                <table class="table">
                    <thead class="table-danger">
                        <tr>
                            <th>Sr No.</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>College</th>
                            <th>Image</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="tblBodyTag">
                        <tr>
                            <th>1</th>
                            <td>Mark</td>
                            <td>@mdo</td>
                            <td>987654321</td>
                            <td>GITM</td>
                            <td><img src="Images/coding.png" alt=""></td>
                        </tr>

                    </tbody>
                </table>

                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="text-danger text-center mt-2">Update<span class="text-dark">Form</span></h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form action="">
                                    <label class="form-label">Name</label>
                                    <input id="editInputName" type="text" class="form-control">

                                    <label class="form-label">Email address</label>
                                    <input id="editInputEmail" type="email" class="form-control">

                                    <label class="form-label">Mobile Number</label>
                                    <input id="editInputPhone" type="number" class="form-control">

                                    <label class="form-label">College</label>
                                    <input id="editInputCollege" type="text" class="form-control">
                                    
                                    <label class="form-label">Image Source Path</label>
                                    <input id="editInputImage" type="text" class="form-control">

                                    <label class="form-label mt-2">Image Preview</label><br>
                                    <img src="" id="editImagePreview" style="width:100px; height:100px; object-fit:cover; border-radius:5px;">
                                    <!-- <img src="" alt="" id="inputImage"> -->

                                    <br>
                                    <div class="d-grid col-8 mx-auto">
                                        <button id="btn2" data-bs-dismiss="modal" onclick="updateData()" type="button" class="btn btn-success mb-3" >Update</button>
                                    </div>
                                    
                                </form>
                            </div>
                            <!-- <div class="modal-footer">
                                <button  type="button" class="btn btn-primary">Save changes</button>
                            </div> -->
                        </div>
                    </div>
                </div>
                <input type="hidden" id="editIndexStorage"> <!-- to store index value of the row which is to be edited -->


            </div>
        </div>
    </div>

    <script>
        // let storageArr = []

        let storedData = window.localStorage.getItem("userDataKeyInLS")

        let usersArr = [{
            Name: "max",
            Email: "max@gmail.com",
            Phone: "987654321",
            College: "maxtech",
            Image : "Images/coding.png"
        }]

        // storageArr.push(usersArr[0])

        if (storedData != null) 
            {
                usersArr = JSON.parse(storedData)
                // storageArr.push(data)
                // console.log(storageArr)
            }
            else
            {
                window.localStorage.setItem("userDataKeyInLS", JSON.stringify(usersArr))
                // storageArr.push(data)
                // console.log(storageArr)
            }


        var updateObj = document.getElementById("btn2")
        updateObj.style.display = "none"

        // let staticData = 

        function addUser() {
            let nameVal = document.getElementById("inputName").value
            let emailVal = document.getElementById("inputEmail").value
            let phoneVal = document.getElementById("inputPhone").value
            let collegeVal = document.getElementById("inputCollege").value
            let imageVal = document.getElementById("inputImage").value

            // console.log(nameVal, emailVal, phoneVal, collegeVal)

            const data = {
                Name: nameVal,
                Email: emailVal,
                Phone: phoneVal,
                College: collegeVal,
                Image : imageVal
            }

            usersArr.push(data)
            // console.log(usersArr)

            window.localStorage.setItem("userDataKeyInLS", JSON.stringify(usersArr))


            tableLoad() // breaking this function into two parts
            // console.log(rows);

        }

        function tableLoad() {
            var rows = ""

            usersArr.forEach((item, index, array) => {
                // rows = rows + `<tr> <th>${index + 1}</th> <td>${item.Name}</td> <td>${item.Email}</td> <td>${item.Phone}</td> <td>${item.College}</td> <td><button id="btn" onclick="delData(${index})" type="button" class="btn btn-primary mb-3 text-white"> Delete </button> <button id="btn" onclick="editData(${index})" type="button" class="btn btn-warning mb-3 text-white" data-bs-toggle="modal" data-bs-target="#exampleModal"> Edit </button></td> </tr>`
                rows = rows + `<tr> 
                                    <th>${index + 1}</th> 
                                    <td>${item.Name}</td> 
                                    <td>${item.Email}</td> 
                                    <td>${item.Phone}</td> 
                                    <td>${item.College}</td>
                                    <td>
                                        <img src="${item.Image}" alt="User Image" style="width:50px; height:50px; object-fit: cover; border-radius: 5px;">
                                    </td> 
                                    <td>
                                        <button id="btn" onclick="delData(${index})" type="button" class="btn btn-primary mb-3 text-white"> Delete </button> 
                                        <button id="btn4" type="button" onclick="editData(${index})" class="btn btn-warning mb-3 text-white" data-bs-toggle="modal" data-bs-target="#exampleModal"> Edit </button>
                                    </td> 
                                </tr>`

            })
            document.getElementById("tblBodyTag").innerHTML = rows

        }

        function delData(index_received_1) {
            // alert(index_received_1)
            usersArr.splice(index_received_1, 1)
            window.localStorage.setItem("userDataKeyInLS", JSON.stringify(usersArr))
            // console.log(usersArr);
            tableLoad()

        }

        function editData(index_received_2) {
            // var submitObj = document.getElementById("btn1")
            // submitObj.style.display = "none"
            // updateObj.style.display = "block"
            // window.indexVar = index_received_2 

            let editIndexStorageObj = document.getElementById("editIndexStorage")
            editIndexStorageObj.value = index_received_2


            let user = usersArr[index_received_2]  // get the selected user's data

            document.getElementById("editInputName").value = user.Name
            document.getElementById("editInputEmail").value = user.Email
            document.getElementById("editInputPhone").value = user.Phone
            document.getElementById("editInputCollege").value = user.College
            document.getElementById("editInputImage").value = user.Image
            document.getElementById("editImagePreview").src = user.Image
        }

        function updateData() {
            let editIndexStorageObj = document.getElementById("editIndexStorage")

            let updateNameVal = document.getElementById("editInputName").value
            let updateEmailVal = document.getElementById("editInputEmail").value
            let updatePhoneVal = document.getElementById("editInputPhone").value
            let updateCollegeVal = document.getElementById("editInputCollege").value
            let updateImageVal = document.getElementById("editInputImage").value

            const updatedData = {
                Name: updateNameVal,
                Email: updateEmailVal,
                Phone: updatePhoneVal,
                College: updateCollegeVal,
                Image: updateImageVal
            }

            // usersArr[window.indexVar] = updatedData  
            usersArr[editIndexStorageObj.value] = updatedData
            window.localStorage.setItem("userDataKeyInLS", JSON.stringify(usersArr))



            // document.getElementById("btn1").style.display = "block"
            // updateObj.style.display = "none"
            tableLoad()

        }

        function filterData() {
            
            let rows =""

            var filterVal = document.getElementById("inputFilter").value
            usersArr.forEach((element, index, array) => {
                if (element.Name == filterVal)
                {
                    rows = rows + `<tr> 
                                        <th>${index + 1}</th> 
                                        <td>${element.Name}</td> 
                                        <td>${element.Email}</td> 
                                        <td>${element.Phone}</td> 
                                        <td>${element.College}</td>
                                        <td>
                                            <img src="${element.Image}" alt="User Image" style="width:50px; height:50px; object-fit: cover; border-radius: 5px;">
                                        </td> 
                                        <td>
                                            <button id="btn" onclick="delData(${index})" type="button" class="btn btn-primary mb-3 text-white"> Delete </button> 
                                            <button id="btn" onclick="editData(${index})" type="button" class="btn btn-warning mb-3 text-white" data-bs-toggle="modal" data-bs-target="#exampleModal"> Edit </button>
                                        </td> 
                                    </tr>`
                    // })
                }

            })


            // let rows =""
            // filterOutput.forEach((item, index, array) => {
            //     rows = rows + `<tr> 
            //                         <th>${index + 1}</th> 
            //                         <td>${item.Name}</td> 
            //                         <td>${item.Email}</td> 
            //                         <td>${item.Phone}</td> 
            //                         <td>${item.College}</td>
            //                         <td>
            //                             <img src="${item.Image}" alt="User Image" style="width:50px; height:50px; object-fit: cover; border-radius: 5px;">
            //                         </td> 
            //                         <td>
            //                             <button id="btn" onclick="delData(${index})" type="button" class="btn btn-primary mb-3 text-white"> Delete </button> 
            //                             <button id="btn" onclick="editData(${index})" type="button" class="btn btn-warning mb-3 text-white"> Edit </button>
            //                         </td> 
            //                     </tr>`
            // })


            // console.log(filterOutput)

            // usersArr = filterOutput
            // tableLoad()

            // let rows =""
            
            document.getElementById("tblBodyTag").innerHTML = rows

        }


    </script>

<script src = "Bootstrap_files/JS/bootstrap.bundle.js"></script>


<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script> -->

</body>

</html>